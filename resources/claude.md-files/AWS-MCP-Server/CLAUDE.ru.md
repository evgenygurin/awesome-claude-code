# Руководство по разработке AWS MCP Server

## Команды сборки и тестирования

### Использование uv (рекомендуется)
- Установка зависимостей: `uv pip install --system -e .`
- Установка зависимостей для разработки: `uv pip install --system -e ".[dev]"`
- Обновление файла блокировки: `uv pip compile --system pyproject.toml -o uv.lock`
- Установка из файла блокировки: `uv pip sync --system uv.lock`

### Использование pip (альтернатива)
- Установка зависимостей: `pip install -e .`
- Установка зависимостей для разработки: `pip install -e ".[dev]"`

### Запуск сервера
- Запуск сервера: `python -m aws_mcp_server`
- Запуск сервера с транспортом SSE: `AWS_MCP_TRANSPORT=sse python -m aws_mcp_server`
- Запуск с MCP CLI: `mcp run src/aws_mcp_server/server.py`

### Тестирование и линтинг
- Запуск тестов: `pytest`
- Запуск одного теста: `pytest tests/path/to/test_file.py::test_function_name -v`
- Запуск тестов с покрытием: `python -m pytest --cov=src/aws_mcp_server tests/`
- Запуск линтера: `ruff check src/ tests/`
- Форматирование кода: `ruff format src/ tests/`

## Технический стек

- **Версия Python**: Python 3.13+
- **Конфигурация проекта**: `pyproject.toml` для конфигурации и управления зависимостями
- **Окружение**: Используйте виртуальное окружение в `.venv` для изоляции зависимостей
- **Управление пакетами**: Используйте `uv` для более быстрого, надежного управления зависимостями с файлом блокировки
- **Зависимости**: Разделение производственных и разработческих зависимостей в `pyproject.toml`
- **Управление версиями**: Используйте `setuptools_scm` для автоматического версионирования из тегов Git
- **Линтинг**: `ruff` для проверки стиля и ошибок
- **Проверка типов**: Используйте VS Code с Pylance для статической проверки типов
- **Структура проекта**: Организуйте код с помощью структуры `src/`

## Рекомендации по стилю кода

- **Форматирование**: Форматирование, совместимое с Black, через `ruff format`
- **Импорты**: Сортировка импортов с помощью `ruff` (стандартная библиотека, сторонние, локальные)
- **Подсказки типов**: Используйте нативные подсказки типов Python (например, `list[str]`, а не `List[str]`)
- **Документация**: Docstrings в стиле Google для всех модулей, классов, функций
- **Именование**: snake_case для переменных/функций, PascalCase для классов
- **Длина функций**: Сохраняйте функции короткими (< 30 строк) и с единственной целью
- **PEP 8**: Следуйте руководству по стилю PEP 8 (обеспечивается через `ruff`)

## Лучшие практики Python

- **Работа с файлами**: Предпочитайте `pathlib.Path` вместо `os.path`
- **Отладка**: Используйте модуль `logging` вместо `print`
- **Обработка ошибок**: Используйте конкретные исключения с контекстными сообщениями и правильным логированием
- **Структуры данных**: Используйте списковые/словарные включения для лаконичного, читаемого кода
- **Аргументы функций**: Избегайте изменяемых аргументов по умолчанию
- **Контейнеры данных**: Используйте `dataclasses` для уменьшения шаблонного кода
- **Конфигурация**: Используйте переменные окружения (через `python-dotenv`) для конфигурации
- **AWS CLI**: Проверяйте все команды перед выполнением (должны начинаться с "aws")
- **Безопасность**: Никогда не храните/не логируйте учетные данные AWS, устанавливайте тайм-ауты команд

## Шаблоны разработки и лучшие практики

- **Предпочитайте простоту**: Выбирайте самое простое решение, отвечающее требованиям
- **Принцип DRY**: Избегайте дублирования кода; повторно используйте существующую функциональность
- **Управление конфигурацией**: Используйте переменные окружения для разных сред
- **Сфокусированные изменения**: Реализуйте только явно запрошенные или полностью понятные изменения
- **Сохраняйте шаблоны**: Следуйте существующим шаблонам кода при исправлении ошибок
- **Размер файла**: Держите файлы менее 300 строк; рефакторите при превышении этого лимита
- **Покрытие тестами**: Пишите комплексные модульные и интеграционные тесты с `pytest`; включайте фикстуры
- **Структура тестов**: Используйте табличные тесты с параметризацией для похожих тестовых случаев
- **Моки**: Используйте unittest.mock для внешних зависимостей; не тестируйте детали реализации
- **Модульный дизайн**: Создавайте повторно используемые, модульные компоненты
- **Логирование**: Реализуйте соответствующие уровни логирования (debug, info, error)
- **Обработка ошибок**: Реализуйте надежную обработку ошибок для надежности в продакшене
- **Лучшие практики безопасности**: Следуйте практикам валидации ввода и защиты данных
- **Производительность**: Оптимизируйте критические секции кода при необходимости
- **Управление зависимостями**: Добавляйте библиотеки только когда это необходимо
  - При добавлении/обновлении зависимостей сначала обновите `pyproject.toml`
  - Регенерируйте файл блокировки с помощью `uv pip compile --system pyproject.toml -o uv.lock`
  - Установите новые зависимости с помощью `uv pip sync --system uv.lock`

## Рабочий процесс разработки

- **Контроль версий**: Коммитьте часто с ясными сообщениями
- **Версионирование**: Используйте теги Git для версионирования (например, `git tag -a 1.2.3 -m "Release 1.2.3"`)
  - Для релизов создавайте и пушьте тег
  - Для разработки позвольте `setuptools_scm` автоматически определять версии
- **Оценка влияния**: Оценивайте, как изменения влияют на другие области кодовой базы
- **Документация**: Поддерживайте документацию в актуальном состоянии для сложной логики и функций
- **Зависимости**: При добавлении зависимостей всегда обновляйте файл `uv.lock`
- **CI/CD**: Все изменения должны проходить проверки CI (тесты, линтинг и т.д.) перед слиянием

